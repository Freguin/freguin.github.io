<html>
	<head>
		<meta charset="UTF-8">
		<style>
		@font-face {
		    font-family: 'Pixelated';
		    src: url("FFFFORWA.TTF") format('truetype');
			}
		</style>
	</head>
	<body style="background-size:cover;left: 0;position: relative;margin: 0;overflow: hidden;">
		<canvas id="canvas" width="500" height="500" ></canvas>
		<script>
			window.onload=function(){
				document.getElementById('canvas').width = document.body.clientWidth;
				document.getElementById('canvas').height = document.body.clientHeight;
				c = document.getElementById('canvas').getContext('2d')
				setInterval(update,1000/30);
				//c.addEventListener("mousemove",function(e){
				//	p1y = e.clientY-paddleHeight/2;
				//});
				document.addEventListener('mousemove',function(e){
					p1y = e.clientY-paddleHeight*0.5;
				});
			}
			width = document.body.clientWidth;
			height = document.body.clientHeight;
			paddle2Speed = 4;
			ballRad = 4;
			ballX = width * 0.5;
			ballY = height * 0.5;
			ballXV = ballYV = 8;
			paddleHeight = height/7;
			paddleWidth = 15;
			p1y = 250-paddleHeight*0.5;
			p2y = 250-paddleHeight*0.5;
			score1 = score2 = 0;
			p1x = 15;
			p2x = width-paddleWidth-15;
			moving = false;
			moveTo;
			
			function reset(){
				ballX = width*0.5;
				ballY = height*0.5;
				if(ballXV>0){
					ballXV = -4;
				} else {
					ballXV = 4;	
				}
			}
			
			function paddleAI(){
				x1=(((ballXV*ballRad)-(ballXV*ballY))/ballYV)+ballX;
				x2=(((ballXV*(height-ballRad))-(ballXV*ballY))/ballYV)+ballX;
				y1 = ballYV*(p2x-ballRad)/ballXV-ballYV*ballX/ballXV+ballY;
				console.log("(paddleAI) x1: " + x1 + ", x2: " + x2 + ", y1: " + y1 + ", XV: " + ballXV + ", YV: " + ballYV + ", X: " + ballX + ", Y: " + ballY);
				function hitsX(xv,yv,x,y){
					console.log("(paddleAI) x1: " + x1 + ", x2: " + x2 + ", y1: " + y1 + ", XV: " + xv + ", YV: " + yv + ", X: " + x + ", Y: " + y);
					x1=(((xv*ballRad)-(yv*y))/yv)+x;
					x2=(((xv*(height-ballRad))-(xv*y))/yv)+x;
					y1 = yv*(p2x-ballRad)/xv-yv*x/xv+y;
			 		if(x1<=width-paddleWidth-15-ballRad){
						hitsX(ballXV,-ballYV,x1,ballRad);
					}
					else if(x2<=width-paddleWidth-15-ballRad){
						hitsX(ballXV,-ballYV,x2,height-ballRad);
					}
					else {
						moveTo = y1;
						moving = true;
					}
				}
			
			function move(to){
				aispeed = 10;
				if((p2y+0.5*paddleHeight)-to>aispeed){
					p2y-=aispeed;
				}
				else if(to-(p2y+0.5*paddleHeight)>aispeed){
					p2y+=aispeed;
				}
			}
			if(x1<=width-paddleWidth-15-ballRad){
				hitsX(ballXV,-ballYV,x1,ballRad);
			}
			else if(x2<=width-paddleWidth-15-ballRad){
				hitsX(ballXV,-ballYV,x2,height-ballRad);
			}
			else {
				moveTo = y1;
				moving = true;
			}
			}
			function update(){
				ballX+=ballXV;
				ballY+=ballYV;
				if(width-ballX<=ballRad){
					score1++;
					reset();
				}
				if(ballX<=ballRad){
					score2++
					reset();
				}
				if(ballX-(p1x+paddleWidth)<=ballRad && ballY-p1y>=ballRad && ballY-(p1y+paddleHeight)<=ballRad && p1x-ballX<=ballRad){
					y = ballYV*(p1x+paddleWidth+ballRad)/ballXV-ballYV*ballX/ballXV+ballY;
					if(y>=p1y-ballRad && y<=p1y+paddleHeight+ballRad) {
					   	ballXV*=-1;
						ballYV=((ballY-(p1y+0.5*paddleHeight))/1.5+ballYV)/2;
					   } 
					else {
					   	ballY = ballY-ballYV;
						ballYV*=-1;
					   }
				}
				if(ballX-(p2x+paddleWidth)<=ballRad && ballY-p2y>=ballRad && ballY-(p2y+paddleHeight)<=ballRad && p2x-ballX<=ballRad){
					y = ballYV*(p2x-ballRad)/ballXV-ballYV*ballX/ballXV+ballY;
					if(y>=p2y-ballRad && y<=p2y+paddleHeight+ballRad) {
					   	ballXV*=-1;
						ballYV=((ballY-(p2y+0.5*paddleHeight))/1.5+ballYV)/2;
					   }
					else {
					   	ballY = ballY-ballYV;
						ballYV*=-1;
					   }
					moving = false;
				}
				if(ballY+ballRad>=height || ballY<=0){
					ballYV*=-1;
				if(ballXV>0){
					paddleAI();
				}
				if(moving){
					move(moveTo);
				}
				c.fillStyle='black';
				c.fillRect(0,0,width,height);
				c.fillStyle='white';
				c.fillRect(15,p1y,paddleWidth,paddleHeight);
				c.fillRect(width-paddleWidth-15,p2y,paddleWidth,paddleHeight);
				c.beginPath();
				c.arc(ballX,ballY, ballRad, 0, 2 * Math.PI, false);
				c.fill()
				c.strokeStyle = '#ffffff';
				c.stroke();
				for(i=0;i<=height;i+=60){
					c.fillRect(width/2,i,10,30);
				}
				c.font = "42px Pixelated"
				c.fillText(score1,width/4,70);
				c.fillText(score2,width*3/4,70);
			}
		</script>
	</body>
</html>
